<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="cerrar()">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ tituloModal }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="modal-content">

    <!-- Hint -->
    <div class="hint-card">
      <ion-icon [name]="iconoServicio"></ion-icon>
      <p>
        @if (tipo === 'CELULAR') {
          Registrá cuando el proveedor agregó saldo virtual a tu cuenta
        } @else {
          Registrá cuando comprás saldo virtual mediante depósito bancario
        }
      </p>
    </div>

    <!-- Input monto -->
    <div class="input-group">
      <label class="input-label">{{ labelMonto }}</label>
      <div class="amount-wrapper" [class.filled]="montoVirtual">
        <span class="currency">$</span>
        <input
          type="number"
          inputmode="decimal"
          placeholder="0.00"
          [(ngModel)]="montoVirtual"
          appCurrencyInput
          appNumbersOnly
          autofocus>
      </div>
    </div>

    <!-- Botones -->
    <div class="modal-actions">
      <button
        class="secondary-btn"
        (click)="cerrar()">
        Cancelar
      </button>
      <button
        class="primary-btn"
        [disabled]="!montoVirtual || montoVirtual <= 0 || saldoBusInsuficiente"
        (click)="confirmar()">
        <ion-icon name="add-circle-outline"></ion-icon>
        @if (tipo === 'CELULAR') {
          Registrar deuda
        } @else {
          Confirmar
        }
      </button>
    </div>

    <!-- Cálculos (solo CELULAR) -->
    @if (mostrarCalculos) {
      <div class="calculo-preview">
        <div class="calculo-row">
          <span>Deuda a pagar al proveedor</span>
          <span class="calculo-danger">${{ montoAPagar | number:'1.2-2' }}</span>
        </div>
        <div class="calculo-row">
          <span>Ganancia ({{ comisionPct }}%) — se transfiere al pagar</span>
          <span class="calculo-success">${{ ganancia | number:'1.2-2' }}</span>
        </div>
      </div>
    }

    <!-- Validación saldo (solo BUS) -->
    @if (tipo === 'BUS' && montoVirtual && montoVirtual > 0) {
      <div class="calculo-preview" [class.error]="saldoBusInsuficiente">
        <div class="calculo-row">
          <span>Saldo disponible CAJA BUS</span>
          <span class="calculo-valor">${{ saldoCajaBus | number:'1.2-2' }}</span>
        </div>
        <div class="calculo-row">
          <span>Saldo después</span>
          <span [class.calculo-success]="!saldoBusInsuficiente" [class.calculo-danger]="saldoBusInsuficiente">
            ${{ saldoBusDespues | number:'1.2-2' }}
            @if (!saldoBusInsuficiente) {
              <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
            } @else {
              <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
            }
          </span>
        </div>
      </div>

      @if (saldoBusInsuficiente) {
        <div class="alerta-saldo">
          <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
          <div>
            <strong>Saldo insuficiente</strong>
            <p>Debe haber efectivo en Caja Bus para poder comprar saldo virtual</p>
          </div>
        </div>
      }
    }

  </div>
</ion-content>
