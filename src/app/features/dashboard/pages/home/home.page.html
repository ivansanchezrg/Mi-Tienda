<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Tienda</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="abrirNotificaciones()" fill="clear" class="notification-btn">
        <div class="bell-wrapper">
          <ion-icon name="notifications-outline"></ion-icon>
          <span *ngIf="notificacionesPendientes > 0" class="notif-badge">{{ deudasPendientesCelular.length }}</span>
        </div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="status-container">
    <div class="flat-chip" [ngClass]="estadoCaja.estado">
      <div class="dot"></div>
      <span class="label">
        {{ estadoCaja.estado === 'TURNO_EN_CURSO' ? 'Caja Abierta' : 'Caja Cerrada' }}
      </span>
      <span class="time" *ngIf="estadoCaja.estado === 'TURNO_EN_CURSO'">
        • {{ estadoCaja.horaApertura }}
      </span>
    </div>
  </div>

  <div class="hero-section">
    <div class="summary-card">
      <span class="label">Total Efectivo</span>
      <h1 class="amount">${{ totalEfectivo | number:'1.2-2' }}</h1>
      <span class="sub-label">Último cierre: {{ fechaUltimoCierre }}</span>
    </div>
  </div>

  <div class="section-title">
    <h2>Cuentas</h2>
  </div>

  <div class="modern-list">
    <div class="flat-item" (click)="onSaldoClick('caja')">
      <div class="icon-wrapper primary">
        <ion-icon name="cash-outline"></ion-icon>
      </div>
      <div class="content">
        <span class="title">Tienda</span>
        <span class="subtitle">Efectivo</span>
      </div>
      <div class="amount-group">
        <span class="value">${{ saldoCaja | number:'1.2-2' }}</span>
        <ion-icon name="chevron-forward"></ion-icon>
      </div>
    </div>

    <div class="flat-item" (click)="onSaldoClick('cajaChica')">
      <div class="icon-wrapper tertiary">
        <ion-icon name="wallet-outline"></ion-icon>
      </div>
      <div class="content">
        <span class="title">Varios</span>
        <span class="subtitle">Gastos menores</span>
      </div>
      <div class="amount-group">
        <span class="value">${{ saldoCajaChica | number:'1.2-2' }}</span>
        <ion-icon name="chevron-forward"></ion-icon>
      </div>
    </div>

    <div class="flat-item" (click)="onSaldoClick('celular')">
      <div class="icon-wrapper secondary">
        <ion-icon name="phone-portrait-outline"></ion-icon>
      </div>
      <div class="content">
        <span class="title">Celular</span>
        <span class="subtitle">Saldo digital</span>
      </div>
      <div class="amount-group">
        <span class="value">${{ saldoCelular | number:'1.2-2' }}</span>
        <ion-icon name="chevron-forward"></ion-icon>
      </div>
    </div>

    <div class="flat-item" (click)="onSaldoClick('bus')">
      <div class="icon-wrapper warning">
        <ion-icon name="bus-outline"></ion-icon>
      </div>
      <div class="content">
        <span class="title">Bus</span>
        <span class="subtitle">Saldo digital</span>
      </div>
      <div class="amount-group">
        <span class="value">${{ saldoBus | number:'1.2-2' }}</span>
        <ion-icon name="chevron-forward"></ion-icon>
      </div>
    </div>
  </div>

  <div class="action-footer-card" [ngClass]="estadoCaja.estado">
    <div class="info">
      <h3>{{ estadoCaja.estado === 'TURNO_EN_CURSO' ? 'Turno Activo' : 'Sin Turno' }}</h3>
      <p>{{ estadoCaja.empleadoNombre || 'Inicia sesión para operar' }}</p>
    </div>
    
    <ion-button 
      *ngIf="estadoCaja.estado === 'TURNO_EN_CURSO'" 
      fill="clear" 
      class="btn-action danger" 
      (click)="onCerrarCaja()">
      Cerrar Turno
    </ion-button>
    
    <ion-button 
      *ngIf="estadoCaja.estado !== 'TURNO_EN_CURSO'" 
      fill="solid" 
      color="dark" 
      class="btn-action" 
      (click)="onAbrirCaja()">
      Abrir Caja
    </ion-button>
  </div>
</ion-content>