<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Mi Tienda</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="abrirNotificaciones()" class="notification-button">
        <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
        <ion-badge *ngIf="notificacionesPendientes > 0" color="danger" class="notification-badge">
          {{ notificacionesPendientes }}
        </ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding-bottom">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content pullingIcon="chevron-down-outline" refreshingSpinner="crescent"></ion-refresher-content>
  </ion-refresher>

  <div class="status-card" [ngClass]="cajaAbierta ? 'abierto' : 'cerrado'">
    <div class="status-left">
      <ion-icon [name]="cajaAbierta ? 'checkmark-circle' : 'close-circle'"></ion-icon>
      <span class="status-text">{{ cajaAbierta ? 'Caja Abierta' : 'Caja Cerrada' }}</span>
    </div>
    <span class="status-date">{{ fechaActual }}</span>
  </div>

  <div class="section-header">
    <div class="header-left">
      <h3>Cuentas</h3>
      <span class="sub-info">Último cierre: {{ fechaUltimoCierre }}</span>
    </div>
    <div class="header-right">
      <span class="total-amount">${{ totalEfectivo | number:'1.2-2' }}</span>
      <span class="total-label">Total Efectivo</span>
    </div>
  </div>

  <ion-card class="modern-card">
    <div class="account-list">
      
      <button class="account-item" (click)="onSaldoClick('caja')">
        <div class="account-icon ion-color-primary">
          <ion-icon name="cash-outline"></ion-icon>
        </div>
        <div class="account-info">
          <div class="name-row">
            <span class="name">Caja Principal</span>
            <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
          </div>
          <span class="type">Efectivo</span>
        </div>
        <span class="account-amount">${{ saldoCaja | number:'1.2-2' }}</span>
      </button>

      <div class="divider"></div>

      <button class="account-item" (click)="onSaldoClick('cajaChica')">
        <div class="account-icon ion-color-tertiary">
          <ion-icon name="wallet-outline"></ion-icon>
        </div>
        <div class="account-info">
          <div class="name-row">
            <span class="name">Caja Chica</span>
            <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
          </div>
          <span class="type">Varios</span>
        </div>
        <span class="account-amount">${{ saldoCajaChica | number:'1.2-2' }}</span>
      </button>

      <div class="divider"></div>

      <button class="account-item" (click)="onSaldoClick('celular')">
        <div class="account-icon ion-color-secondary">
          <ion-icon name="phone-portrait-outline"></ion-icon>
        </div>
        <div class="account-info">
          <div class="name-row">
            <span class="name">Celular</span>
            <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
          </div>
          <span class="type">Saldo digital</span>
        </div>
        <span class="account-amount">${{ saldoCelular | number:'1.2-2' }}</span>
      </button>

      <div class="divider"></div>

      <button class="account-item" (click)="onSaldoClick('bus')">
        <div class="account-icon ion-color-warning">
          <ion-icon name="bus-outline"></ion-icon>
        </div>
        <div class="account-info">
          <div class="name-row">
            <span class="name">Bus</span>
            <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
          </div>
          <span class="type">Saldo digital</span>
        </div>
        <span class="account-amount">${{ saldoBus | number:'1.2-2' }}</span>
      </button>

    </div>
  </ion-card>

  @if (cajaAbierta) {
    <div class="section-header">
      <h3>Operaciones</h3>
    </div>

    <ion-card class="modern-card">
      <div class="actions-grid">
        <button class="action-btn" (click)="onOperacion('ingreso')">
          <div class="icon-box ion-color-success">
            <ion-icon name="arrow-down-outline"></ion-icon>
          </div>
          <span>Ingreso</span>
        </button>

        <button class="action-btn" (click)="onOperacion('egreso')">
          <div class="icon-box ion-color-danger">
            <ion-icon name="arrow-up-outline"></ion-icon>
          </div>
          <span>Egreso</span>
        </button>

        <button class="action-btn" (click)="onOperacion('transferencia')">
          <div class="icon-box ion-color-primary">
            <ion-icon name="swap-horizontal-outline"></ion-icon>
          </div>
          <span>Transferir</span>
        </button>

        <button class="action-btn" (click)="onOperacion('gasto')">
          <div class="icon-box ion-color-warning">
            <ion-icon name="receipt-outline"></ion-icon>
          </div>
          <span>Gasto</span>
        </button>

        <button class="action-btn" (click)="onCuadre()">
          <div class="icon-box ion-color-tertiary">
            <ion-icon name="clipboard-outline"></ion-icon>
          </div>
          <span>Cuadre</span>
        </button>
      </div>
    </ion-card>
  }

  <div class="footer-action">
    <div class="shift-card" [ngClass]="cajaAbierta ? 'is-open' : 'is-closed'">
      <div class="shift-text">
        <span class="shift-label">{{ cajaAbierta ? 'Turno en curso' : 'Turno finalizado' }}</span>
        @if (cajaAbierta) {
          <span class="shift-detail">Apertura: {{ horaApertura }} ({{ nombreUsuario }})</span>
        } @else {
          <span class="shift-detail">Listo para abrir nuevo día</span>
        }
      </div>

      <button class="shift-btn" (click)="cajaAbierta ? onCerrarDia() : onAbrirDia()">
        {{ cajaAbierta ? 'Cerrar' : 'Abrir' }}
      </button>
    </div>
  </div>

</ion-content>