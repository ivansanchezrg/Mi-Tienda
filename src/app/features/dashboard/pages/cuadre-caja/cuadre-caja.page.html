<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="volver()">
        <ion-icon slot="icon-only" name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Cuadre de Caja</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  @if (loading) {
    <div class="loading-state">
      <ion-icon name="calculator-outline"></ion-icon>
      <p>Cargando datos...</p>
    </div>
  } @else {
    <form [formGroup]="form">

      <!-- Header Info -->
      <div class="header-info">
        <ion-icon name="calculator-outline"></ion-icon>
        <p class="info-text">
          Ingresa los saldos virtuales actuales para verificar cuánto efectivo físico deberías tener
        </p>
      </div>

      <!-- Form Content -->
      <div class="form-content">

        <!-- Saldo Celular Actual -->
        <div class="input-group destacado">
          <label class="input-label">
            <ion-icon name="phone-portrait-outline"></ion-icon>
            Saldo Virtual Celular Actual
            <span class="required-badge">Obligatorio</span>
          </label>
          <div class="amount-wrapper" [class.error]="!ventaCelularValida && saldoCelularActual > 0">
            <span class="currency">$</span>
            <input
              type="number"
              inputmode="decimal"
              placeholder="0.00"
              formControlName="saldoCelularActual"
              appCurrencyInput
              appNumbersOnly
              autofocus>
          </div>
          <ion-note class="helper-text">
            Saldo anterior: ${{ saldoAnteriorCelular | number:'1.2-2' }}
          </ion-note>
          @if (!ventaCelularValida && saldoCelularActual > 0) {
            <span class="error-text">
              El saldo actual no puede ser mayor que el anterior
            </span>
          }
        </div>

        <!-- Saldo Bus Actual -->
        <div class="input-group destacado">
          <label class="input-label">
            <ion-icon name="bus-outline"></ion-icon>
            Saldo Virtual Bus Actual
            <span class="required-badge">Obligatorio</span>
          </label>
          <div class="amount-wrapper" [class.error]="!ventaBusValida && saldoBusActual > 0">
            <span class="currency">$</span>
            <input
              type="number"
              inputmode="decimal"
              placeholder="0.00"
              formControlName="saldoBusActual"
              appCurrencyInput
              appNumbersOnly>
          </div>
          <ion-note class="helper-text">
            Saldo anterior: ${{ saldoAnteriorBus | number:'1.2-2' }}
          </ion-note>
          @if (!ventaBusValida && saldoBusActual > 0) {
            <span class="error-text">
              El saldo actual no puede ser mayor que el anterior
            </span>
          }
        </div>

        <!-- Resultado: Efectivo Vendido -->
        @if (mostrarResultado) {
          <ion-card class="result-card">
            <div class="result-header">
              <ion-icon name="cash-outline"></ion-icon>
              <span>Efectivo Físico Vendido</span>
            </div>

            <div class="result-content">
              <!-- Venta Celular -->
              <div class="result-item">
                <div class="result-label">
                  <ion-icon name="phone-portrait-outline"></ion-icon>
                  <span>Celular</span>
                </div>
                <span class="result-value success">
                  ${{ ventaCelular | number:'1.2-2' }}
                </span>
              </div>

              <!-- Venta Bus -->
              <div class="result-item">
                <div class="result-label">
                  <ion-icon name="bus-outline"></ion-icon>
                  <span>Bus</span>
                </div>
                <span class="result-value success">
                  ${{ ventaBus | number:'1.2-2' }}
                </span>
              </div>
            </div>

            <!-- Info adicional -->
            <div class="result-footer">
              <ion-icon name="information-circle-outline"></ion-icon>
              <p>Deberías tener este monto en efectivo físico en tu caja</p>
            </div>
          </ion-card>
        }

        <!-- Botón Confirmar (Testing) -->
        @if (mostrarResultado) {
          <button
            type="button"
            class="primary-btn"
            (click)="confirmarRecargas()">
            Confirmar Recargas (Testing)
          </button>
        }

        <!-- Botón Limpiar -->
        @if (form.value.saldoCelularActual || form.value.saldoBusActual) {
          <button
            type="button"
            class="secondary-btn"
            (click)="limpiar()">
            Limpiar
          </button>
        }
      </div>

    </form>
  }
</ion-content>
